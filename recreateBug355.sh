#!/bin/bash
set -euo pipefail

curl --retry-delay 50 --retry-connrefused --location \
     --request POST 'http://127.0.0.1:8551' \
     --header 'Content-Type: application/json' \
     --data-raw '{
  "jsonrpc": "2.0",
  "id": 1455,
  "method": "engine_forkchoiceUpdatedV1",
  "params": [
    {
      "headBlockHash": "0x0bd6c118949ea4ec45efb24adef5f5ca4e5b60c12816f7106c27bd2d52f3c10d",
      "safeBlockHash": "0x6dcd448c0a6bdc6f226dd389163895853d365d2c470459e4af433cfdcfc73ba9",
      "finalizedBlockHash": "0x0384df45ef029b2c1386980e8a3b2e99629288182dff764448b1eaaa666bc325"
    },
    {
      "timestamp": "0x63da907c",
      "prevRandao": "0xc4eea97a2c014a76796d313032dc5b977be951bab5b6e516d61f87dd5a621b61",
      "suggestedFeeRecipient": "0xf97e180c050e5ab072211ad2c213eb5aee4df134"
    }
  ]
}'

sleep 1

curl --retry-delay 50 --retry-connrefused --location \
     --request POST 'http://127.0.0.1:8551' \
     --header 'Content-Type: application/json' \
     --data-raw '{
    "jsonrpc": "2.0",
    "id": 1456,
    "method": "engine_newPayloadV1",
    "params": [
        {
            "parentHash": "0x0bd6c118949ea4ec45efb24adef5f5ca4e5b60c12816f7106c27bd2d52f3c10d",
            "feeRecipient": "0xf97e180c050e5ab072211ad2c213eb5aee4df134",
            "stateRoot": "0x41c2009944560657e647c6a9bae8893526ebbb21b8f0eb8eff8957dec49bf40e",
            "receiptsRoot": "0x0891efc48a7f6c4496f9dd9ef9e3545ee8e659420522ac00ec84c146affc1665",
            "logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
            "prevRandao": "0xc4eea97a2c014a76796d313032dc5b977be951bab5b6e516d61f87dd5a621b61",
            "blockNumber": "0x163",
            "gasLimit": "0x1be443f",
            "gasUsed": "0x10fba8",
            "timestamp": "0x63da9070",
            "extraData": "0x",
            "baseFeePerGas": "0xa",
            "blockHash": "0xa49aa7fa822c77d549cc2f54dc8f19a4e0161769794111f3b809b1c79305659d",
            "transactions": [
                "0xf8544a850165a0bc16830186a08080808328d3b9a0057481f9f8d0d98542cef2bae7891702ed2cff9117b4aaf08dc59c0bb2554f15a04418ff2b12690fffed011f090745363234a364faff5026d215d5379b751b23f6",
                "0xf85449850165a0bc16830186a08080808328d3baa0d85b5a9414a24f5ca74dc7649a2a4b162ea251c29b4c995aae6097b09b88390ca01e0835bc538bef16f045bd8f54f13eecf107eadcac8300d750587682e54e8ce3",
                "0xf85449850165a0bc16830186a08080808328d3b9a056fd8ec992df74098b31be3748745b43dd5b9d50a71fcc7538fc11ad2705aa2aa0331c5a56dd281ef6f436a1bfc2ca25d0155be396d42bbb27446a60dce59160ce",
                "0xf85448850165a0bc16830186a08080808328d3b9a077a21548eae5fdc3343bae8b98d58978690aa664af40459e424c01ed6617edf7a02f47c9263c5974d6ced81cee42c94f60f8ec5f51df87542aa477fede2a06852e",
                "0xf8544b850165a0bc16830186a08080808328d3b9a04ee65b754b50b9148d2c21de13800807f3d727bdb30bb380fd6a986c9b436e6ca04fee5591d5acf82c184f79a5df3cecb8949b781f584abfaeb73c8ecf0223aa0e",
                "0xf8544a850165a0bc16830186a08080808328d3b9a0b2e14e45727262920a9a4f4ceeb1cfb04aa108d0b1088555e0f2ee04b8e7ea50a02abda8fc018ee5aaee1290321c6eddcb360b9a5d9b5f827b136263046cca4aa7",
                "0xf8534a850165a0bc16830186a08080808328d3baa088b8f9e9265c884292ecf22a7f4208c07894816299336083fc595c24937d8b419ff1311b3f60080a12caef2ae2f4c6b0be77b8360e4476d59cea21d441307be4",
                "0xf8544c850165a0bc16830186a08080808328d3b9a0c21ef1e834a375dbe69fe1bf2e4f4fc4f89afa3e6de4a6644aaabec52b757fd9a06c02daf6ca816516f085b893d38868f985a29c3d938a512f4e2f7551b6765dbd",
                "0xf8544b850165a0bc16830186a08080808328d3b9a099dd14d2f5bada0d2e864b5982df3ba22a12595d40b060e55988c13c7c2bf9aba0260b041d5f543bbc7095b023a894e5795bef0c3ba933575079d51f2f614d3b12",
                "0xf8544b850165a0bc16830186a08080808328d3b9a07b358ed4cd4bcb84bbc5e0bec71764818e0a63740eaa1427f2cae66822abb228a001302bc26eb84b8c068399a8d89e178642a4da583b0a4ac12daff289e9c5e898",
                "0xf8544d850165a0bc16830186a08080808328d3b9a0e7b7e575d433891e5913a3996cc85ea744f67f6766e99f4c049d991423ff5753a079721ad0b6ebe667366a491e3fdc3a795ceb7d411609a7bcc8b2b8fb0d45257d",
                "0xf8544c850165a0bc16830186a08080808328d3baa0c44abe4eea66cc6c2ca021ae89e1cc79d8283734898365407987603f031b3816a06823ebfedceadaf93cef58587a2a46fc070225843fde33c61183f0d44d6deae2",
                "0xf8544c850165a0bc16830186a08080808328d3baa093539cb9399cbc7be147285483f532684407abbd8feb45493bc40cc58a9c836ca05ad6e398112b39f2c4f447c4c2927a0680b3680d911ed78b1a94e76b55208922",
                "0xf8544d850165a0bc16830186a08080808328d3b9a0ffd28f0fa5cb19b5ed0990700035b29fa3c50c0ee408f93602b7e448950aeceba02fa0f63ad241723ef1f1f83e0564ccde28f74a60db65239fd1f563bd2837182c",
                "0xf8544e850165a0bc16830186a08080808328d3b9a0b31787f078d538eb5445aff83fd30c3836c7ad6abf727be0ef70701521b63c13a06b7fc623bea458c7b513fcdcaf4af6fa2f3483a0d3217f251c541b3fa5c6f54f",
                "0xf8544d850165a0bc16830186a08080808328d3baa0311097f709aa0c40ef723bbd061ee370fe8f53f5488285b002ffa36555842c50a07cb563847a3022100b9e9607673937e88c61c0e85dd323080508f077ae7ff516",
                "0xf8544f850165a0bc16830186a08080808328d3baa0b49459141e8840b3d0fa8904497bc0c13a510a79efad037849391342d42e8c45a067fc1d6bd8ac9689cae7d900fbb235a2f2e3bbe83f4307f1c70275ca707dda3e",
                "0xf8544e850165a0bc16830186a08080808328d3b9a010f0db6ed23c69ff5ad010eb12b088ec9d042ae7eeb23400122254d6a87c542ca01c7aeb84a88fc6e1999f028ee2c8708c10d9b144d60a34d85b477570a717145f",
                "0xf8544e850165a0bc16830186a08080808328d3baa02f29543315ea24d7441227d54ed8dfe5e3cbf6f3b17703b56d922b04a8528ed9a06a02f3cb265b5e2d058e80ef0fbdee44aa88c23c9e729e55c42bb928a8021863",
                "0xf8544f850165a0bc16830186a08080808328d3baa0c69c67e2de83df935a492e64019e77eae010e5967162cf6568a9ae3e6dded790a0645d88d984a6da45dedccf55c5f6bebedc8d966635e3c141fdb20809ad6eb66c",
                "0xf8544f850165a0bc16830186a08080808328d3b9a05eb1b8a8e856205aa235fe97eaa1eaa3e601e474e1865ffb84c201e19beaa258a0234f658050e07f68883c4bc399743aa4c5c03c6acab5d1e819f25e1d68691d34"
            ]
        }
    ]
}'

sleep 1

curl --retry-delay 50 --retry-connrefused --location \
     --request POST 'http://127.0.0.1:8551' \
     --header 'Content-Type: application/json' \
     --data-raw '{
  "jsonrpc": "2.0",
  "id": 1457,
  "method": "engine_forkchoiceUpdatedV1",
  "params": [
    {
      "headBlockHash": "0xa49aa7fa822c77d549cc2f54dc8f19a4e0161769794111f3b809b1c79305659d",
      "safeBlockHash": "0x6dcd448c0a6bdc6f226dd389163895853d365d2c470459e4af433cfdcfc73ba9",
      "finalizedBlockHash": "0x0384df45ef029b2c1386980e8a3b2e99629288182dff764448b1eaaa666bc325"
    },
    {
      "timestamp": "0x63da907c",
      "prevRandao": "0x659a22aa61d9a2ef47b9e3c9fdee91c19057f7f3de9eff625b5f9af380284ed7",
      "suggestedFeeRecipient": "0xf97e180c050e5ab072211ad2c213eb5aee4df134"
    }
  ]
}'

sleep 1

curl --retry-delay 50 --retry-connrefused --location \
     --request POST 'http://127.0.0.1:8551' \
     --header 'Content-Type: application/json' \
     --data-raw '{
    "jsonrpc": "2.0",
    "method": "engine_getPayloadV1",
    "params": [
      "0x00542a3a13ffb07c"
    ],
    "id": 67
}'
